import pandas as pd
from pandasql import sqldf
from reportlab.lib.pagesizes import letter
from reportlab.platypus import SimpleDocTemplate, Table, TableStyle
from reportlab.lib import colors

# ParÃ¡metros configurables
archivo = 'archivo.xlsx'
hoja = 'EDOIM'
usecols = ['Unnamed: 0', 'Unnamed: 1', 'Unnamed: 2']

# 1. Leer la hoja EDOIM y columnas deseadas
df = pd.read_excel(archivo, sheet_name=hoja, usecols=usecols)
print("Columnas cargadas:", df.columns.tolist())

# 2. Filtrar datos con pandasql
query = """
SELECT `Unnamed: 0` AS Col0,
       `Unnamed: 1` AS Col1
FROM df
WHERE `Unnamed: 2` > 100
"""
resultado = sqldf(query, globals())

# 3. Generar PDF con estilo de tabla (usando ReportLab)
pdf_path = "reporte_tabla.pdf"
pdf = SimpleDocTemplate(pdf_path, pagesize=letter)

# Preparar datos para la tabla: encabezado + filas
data = [resultado.columns.tolist()] + resultado.values.tolist()

# Estilos de tabla: header gris y filas con fondo alternado
style = TableStyle([
    ('BACKGROUND', (0, 0), (-1, 0), colors.grey),
    ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
    ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
    ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
    ('FONTSIZE', (0, 0), (-1, 0), 12),
    ('BOTTOMPADDING', (0, 0), (-1, 0), 8),
    ('BACKGROUND', (0, 1), (-1, -1), colors.beige),
    ('GRID', (0, 0), (-1, -1), 1, colors.black),
])

# Crear la tabla y generar el PDF
table = Table(data)
table.setStyle(style)
elements = [table]
pdf.build(elements)

print(f"PDF generado con tabla: {pdf_path}")
